{% extends 'pkk/base.html' %}


  {% block title %}<title>Кадастровые инженеры Новосибирска</title>{% endblock title %}
  {% block description %}
<meta name="description" content="Кадастровые инженеры Новосибирска">
{% endblock description %}



{% block content %}
<div class="m-auto  " >
    <h1 class="text-center">Публичная кадастровая карта</h1>




    <!-- <script>
        initMap();

        async function initMap() {
            await ymaps3.ready;

            const {YMap, YMapDefaultSchemeLayer} = ymaps3;

            const map = new YMap(
                document.getElementById('map'),
                {
                    location: {
                        center: [37.588144, 55.733842],
                        zoom: 10
                    }
                }
            );

            map.addChild(new YMapDefaultSchemeLayer());
        }
    </script>-->


<div class="position-relative m-auto" style="width: 90%;">
<div id="map" style="width: 100%; height: 80vh"> </div>
<div class="mx-3 position-absolute" style="top:12px; left: 30px; z-index:999; background-color: white;" >
    <form action="" method="POST" style="width: 350px" id="form">
        {% csrf_token %}
        <input type="text" name="build_kad_num" id="id_1" placeholder="Введите адрес или кадастровый номер" style="border: none; font-size: 15px; width:84%;" class="px-1">
        <button type="submit" style="background-color: white; border: none;">
    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30" height="30" viewBox="0 0 50 50">
<path d="M 21 3 C 11.601563 3 4 10.601563 4 20 C 4 29.398438 11.601563 37 21 37 C 24.355469 37 27.460938 36.015625 30.09375 34.34375 L 42.375 46.625 L 46.625 42.375 L 34.5 30.28125 C 36.679688 27.421875 38 23.878906 38 20 C 38 10.601563 30.398438 3 21 3 Z M 21 7 C 28.199219 7 34 12.800781 34 20 C 34 27.199219 28.199219 33 21 33 C 13.800781 33 8 27.199219 8 20 C 8 12.800781 13.800781 7 21 7 Z"></path>
</svg>
    </button>
    </form>
</div>
<div class="mx-3 position-absolute" style="top:48px; left: 30px; z-index:999; background-color: white; width:350px; max-height: 74vh; overflow-y: auto; overflow-x:clip; font-size: 14px;">
    <div id="result" style=></div>
</div>
    </div>

</div>
 <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.easybutton/dist/leaflet.easybutton.js"></script>
    <script src='http://originalsin.github.io/Leaflet.TileLayer.Rosreestr/src/TileLayer.Rosreestr.js'></script>
    <script src="/static/pkk/js/leaflet-bing-layer.js"></script>
       <script src="/static/pkk/js/pkk.js"></script>
    <script>
      // Создаем карту
      var map = L.map('map').setView([55.0302, 82.9205], 15); // Новосибирск

      // Добавляем базовые тайлы (Яндекс Карты)
      /*L.tileLayer('https://tiles.api-maps.yandex.ru/v1/tiles/?x=9902&y=5137&z=14&lang=ru_RU&l=map&apikey=5d79c54c-d4f6-44a5-92f5-de2250c24722', {
        attribution: '&copy; <a href="https://yandex.ru/maps/">Яндекс Карты</a>',
        maxZoom: 17
      }).addTo(map);*/


    var BING_KEY = 'AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L'

    var bingLayer = L.tileLayer.bing(BING_KEY)


     var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> '
}).addTo(map);

       var wmsLayer = L.tileLayer.Rosreestr('https://pkk.rosreestr.ru/arcgis/rest/services/PKK6/CadastreObjects/MapServer/export?layers=show%3A30%2C27%2C24%2C23%2C22&dpi=96&format=PNG32&bboxSR=102100&imageSR=102100&size=1024%2C1024&transparent=true&f=image&bbox={bbox}', {

        tileSize: 1024,
        attribution: 'Публичная кадастровая карта'
       }).addTo(map);

       var wmsLayertz = L.tileLayer.Rosreestr('https://pkk.rosreestr.ru/arcgis/rest/services/PKK6/ZONES/MapServer/export?layers=show%3A5&dpi=96&format=PNG32&bbox={bbox}&bboxSR=102100&imageSR=102100&size=1024%2C1024&transparent=true&f=image&_ts=false', {

        tileSize: 1024,
        attribution: 'Публичная кадастровая карта'
       });

      var baseLayers = {
    "Bing": bingLayer,
    "OpenStreetMap": osm
};

var overlays = {
    "Росреестр": wmsLayer,
    "Территориальные зоны": wmsLayertz
};

var layerControl = L.control.layers(baseLayers, overlays).addTo(map);

L.control.attribution( {prefix: false, });



map.on('click', function(ev) {
   b =ev.latlng;
   lat = b.lat.toFixed(6);
   lng = b.lng.toFixed(6);
   var tooltip = L.tooltip(b, {content: lat + ', ' + lng,})
    .addTo(map);
       // ev is an event object (MouseEvent in this case)
});



/*a = function(ev){ev.latlng};
console.log('a');
console.log(b);*/



/*const provider = new window.GeoSearch.OpenStreetMapProvider();
const search = new GeoSearch.GeoSearchControl({ provider: provider, style: 'bar', updateMap: true, autoClose: true,});
// Include the search box with usefull params. Autoclose and updateMap in my case. Provider is a compulsory parameter.*/

/*L.marker([51.0, -0.09]).addTo(map).bindPopup('A pretty CSS3 popup.<br> Easily customizable.');
//Creates a marker at [latitude, longitude] coordinates.*/





/*      // Добавьте кнопку zoom
      L.easyButton('<span class="fa fa-search-plus"></span>', function(btn, map) {
        map.zoomIn();
      }, 'Увеличить').addTo(map);

      // Добавьте кнопку zoom out
      L.easyButton('<span class="fa fa-search-minus"></span>', function(btn, map) {
        map.zoomOut();
      }, 'Уменьшить').addTo(map);*/
    </script>






 {% endblock %}